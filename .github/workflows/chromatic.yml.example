# Chromatic GitHub Actions Workflow (Example)
# 
# This is an EXAMPLE workflow for automating Chromatic publishes.
# To use it:
# 1. Rename this file to 'chromatic.yml' (remove .example)
# 2. Add your CHROMATIC_PROJECT_TOKEN to GitHub Secrets
# 3. Adjust the branches as needed
#
# Learn more: https://www.chromatic.com/docs/github-actions

name: 'Chromatic Publish'

# Run on pushes to these branches
on: 
  push:
    branches:
      - main
      - develop
  # Optionally, run on pull requests
  # pull_request:
  #   branches:
  #     - main

jobs:
  chromatic:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout repository code
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Required by Chromatic for accurate change detection

      # 2. Setup Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      # 3. Install dependencies
      - name: Install dependencies
        run: npm ci

      # 4. Publish to Chromatic
      - name: Publish to Chromatic
        uses: chromaui/action@latest
        with:
          # Token from GitHub Secrets
          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
          
          # Don't fail the build on changes
          exitZeroOnChanges: true
          
          # Auto-accept changes on main branch (optional)
          autoAcceptChanges: 'main'
          
          # Build script name (adjust if different)
          buildScriptName: 'build-storybook'

      # 5. Comment PR with Chromatic results (optional)
      # - name: Comment PR with Chromatic URL
      #   if: github.event_name == 'pull_request'
      #   uses: actions/github-script@v7
      #   with:
      #     script: |
      #       github.rest.issues.createComment({
      #         issue_number: context.issue.number,
      #         owner: context.repo.owner,
      #         repo: context.repo.repo,
      #         body: 'ðŸŽ¨ Storybook published to Chromatic!'
      #       })

